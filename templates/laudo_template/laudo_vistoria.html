<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Laudo de Vistoria Cautelar</title>
  <style>
    @page { size: A4; margin: 2cm; }
    body { font-family: Arial, sans-serif; font-size: 12px; color: #000; margin: 0; padding: 0; }
    .page { page-break-after: always; }
    h1, h2 { text-align: center; }
    h1 { font-size: 18px; margin: 0 0 16px; }
    h2 { font-size: 14px; margin: 24px 0 8px; border-bottom: 1px solid #ccc; padding-bottom: 6px; }
    .campo { margin-bottom: 8px; }
    .box { background: #f2f2f2; padding: 10px; border: 1px solid #ccc; font-size: 11px; }
    /* Assinaturas */
    .assinaturas { width: 100%; border-collapse: collapse; margin-top: 24px; }
    .assinaturas td { width: 33%; text-align: center; vertical-align: top; padding: 0 8px; }
    .assinatura-caixa { height: 80px; border: 1px solid #000; margin: 0 0 6px; padding: 4px; }
    .linha { border-top: 1px solid #000; margin-top: 8px; padding-top: 4px; font-size: 11px; }
    /* Fotos */
    .fotos-tabela { width: 100%; border-collapse: separate; border-spacing: 10px; margin-top: 8px; }
    .fotos-tabela td { width: 50%; text-align: center; vertical-align: top; }
    .foto-box { border: 1px solid #ccc; padding: 4px; }
    .foto-img { max-width: 100%; max-height: 300px; display: block; margin: 0 auto 6px; }
    .foto-cap { font-size: 11px; }
  </style>
</head>
<body>

  <!-- P√ÅGINA 1 -->
  <div class="page">
    <h1>LAUDO DE VISTORIA CAUTELAR</h1>

    <h2>üìç Dados do Atendimento</h2>
    <div class="campo"><strong>Data da Vistoria:</strong> {{ vistoria.data_1.strftime('%d/%m/%Y') if vistoria.data_1 else '‚Äî' }} √†s {{ vistoria.hora_1 if vistoria.hora_1 else '‚Äî' }}</div>
    <div class="campo"><strong>Respons√°vel pelas informa√ß√µes:</strong> {{ vistoria.nome_responsavel or comunicacao.nome or "‚Äî" }}</div>
    <div class="campo"><strong>V√≠nculo com o im√≥vel:</strong> {{ vistoria.tipo_vinculo or "‚Äî" }}</div>
    <div class="campo"><strong>Endere√ßo:</strong> {{ comunicacao.endereco or "‚Äî" }}, {{ comunicacao.numero or "‚Äî" }} - {{ comunicacao.bairro or "‚Äî" }}, {{ vistoria.municipio or "‚Äî" }}</div>
    <div class="campo"><strong>Telefone:</strong> {{ comunicacao.telefone or "‚Äî" }}</div>
    <div class="campo"><strong>Tipo de Im√≥vel:</strong> {{ vistoria.tipo_imovel or comunicacao.tipo_imovel or "‚Äî" }}</div>
    <div class="campo"><strong>Uso:</strong> {{ vistoria.uso or "‚Äî" }}</div>
    <div class="campo"><strong>Soleira:</strong> {{ vistoria.soleira or "‚Äî" }}</div>
    <div class="campo"><strong>Tipo de Cal√ßada:</strong> {{ vistoria.calcada or "‚Äî" }}</div>

    <h2>üìÖ Tentativas de Vistoria</h2>
    <div class="campo">1¬™ Tentativa: {{ vistoria.data_1.strftime('%d/%m/%Y') if vistoria.data_1 else '‚Äî' }} √†s {{ vistoria.hora_1 or '‚Äî' }}</div>
    <div class="campo">2¬™ Tentativa: {{ vistoria.data_2.strftime('%d/%m/%Y') if vistoria.data_2 else '‚Äî' }} √†s {{ vistoria.hora_2 or '‚Äî' }}</div>
    <div class="campo">3¬™ Tentativa: {{ vistoria.data_3.strftime('%d/%m/%Y') if vistoria.data_3 else '‚Äî' }} √†s {{ vistoria.hora_3 or '‚Äî' }}</div>

    <h2>üìÑ Observa√ß√µes</h2>
    <div class="campo">{{ vistoria.observacoes or "‚Äî" }}</div>

    <h2>üìò Norma T√©cnica</h2>
    <div class="box">
      ABNT NBR 12722:1992 ‚Äì Discrimina√ß√£o de servi√ßos para constru√ß√£o de edif√≠cios.<br>
      Item 4.1.10.3: Toda vez que for necess√°rio resguardar interesses de propriedades vizinhas ou de uso p√∫blico, √© obrigat√≥ria a realiza√ß√£o da vistoria cautelar...
    </div>

    <h2>üîí LGPD</h2>
    <div class="box">
      Em conformidade com a Lei Geral de Prote√ß√£o de Dados (LGPD), ao realizarmos vistoria cautelar em seu im√≥vel, coletaremos informa√ß√µes estritamente necess√°rias para este fim. Esses dados ser√£o mantidos em sigilo e utilizados exclusivamente para emiss√£o do presente laudo t√©cnico.
    </div>
  </div>

  <!-- P√ÅGINA 2: Assinaturas + Fotos -->
  <div class="page">
    <h2>‚úçÔ∏è Assinaturas</h2>
    <table class="assinaturas">
      <tr>
        <!-- Engenheiro -->
        <td>
          <div class="assinatura-caixa"></div>
          <div class="linha">
            <strong>Engenheiro Respons√°vel</strong><br>
            Fulano de Tal<br>
            CREA: 0000000000-D
          </div>
        </td>

        <!-- Vistoriador -->
        <td>
          <div class="assinatura-caixa"></div>
          <div class="linha">
            <strong>Vistoriador</strong><br>
            {{ vistoria.usuario.nome if vistoria.usuario else '________________' }}<br>
            RG: {{ vistoria.usuario.rg if vistoria.usuario and vistoria.usuario.rg else '___________' }}
          </div>
        </td>

        <!-- Morador -->
        <td>
          {% if vistoria.assinatura_base64 %}
            <img src="{{ vistoria.assinatura_base64 }}" alt="Assinatura do Morador" class="assinatura-caixa" style="object-fit:contain;">
          {% else %}
            <div class="assinatura-caixa"></div>
          {% endif %}
          <div class="linha">
            <strong>Morador</strong><br>
            {{ comunicacao.nome or '________________' }}<br>
            CPF: {{ comunicacao.cpf or '___.___.___-__' }}
          </div>
        </td>
      </tr>
    </table>

    {% if fotos %}
      <h2>üì∑ Fotos da Vistoria</h2>
      <table class="fotos-tabela">
        {% for linha in fotos|batch(2, {}) %}
          <tr>
            {% for f in linha %}
              <td>
                {% if f and f.get('base64') %}
                  <div class="foto-box">
                    <img class="foto-img" src="data:image/jpeg;base64,{{ f.base64 }}" alt="{{ f.titulo or 'Foto' }}">
                    <div class="foto-cap">{{ f.titulo or 'Sem t√≠tulo' }}</div>
                  </div>
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </table>
    {% endif %}
  </div>

</body>
</html>
